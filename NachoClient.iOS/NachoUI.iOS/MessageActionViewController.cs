// This file has been autogenerated from a class added in the UI designer.

using System;
using System.Collections.Generic;
using MonoTouch.Foundation;
using MonoTouch.UIKit;
using NachoCore;
using NachoCore.Model;

namespace NachoClient.iOS
{
    public partial class MessageActionViewController : BlurryViewController, IUITableViewDelegate, INachoFolderChooser
    {
        protected object cookie;
        protected INachoFolderChooserParent owner;
        protected INachoFolders folders = null;

        public MessageActionViewController (IntPtr handle) : base (handle)
        {
        }

        public void SetOwner (INachoFolderChooserParent owner, object cookie)
        {
            this.owner = owner;
            this.cookie = cookie;
        }

        public void DismissFolderChooser (bool animated, NSAction action)
        {
            owner = null;
            cookie = null;
            DismissViewController (animated, action);
        }

        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();

            dismissButton.TouchUpInside += (object sender, EventArgs e) => {
                DismissViewController (true, null);
            };

            folderTableView.Delegate = new FolderTableDelegate (this);
            folderTableView.BackgroundColor = UIColor.Clear;
        }

        public override void ViewWillAppear (bool animated)
        {
            base.ViewWillAppear (animated);

            var folderSource = new FolderTableSource ();
            folderSource.cellTextColor = UIColor.White;
            folderTableView.DataSource = folderSource;
        }

        public void FolderSelected (McFolder folder)
        {
            owner.FolderSelected (this, folder, cookie);
        }

        protected class FolderTableDelegate : UITableViewDelegate
        {
            MessageActionViewController owner = null;

            public FolderTableDelegate (MessageActionViewController owner)
            {
                this.owner = owner;
            }

            public override void RowSelected (UITableView tableView, NSIndexPath indexPath)
            {
                var folderSource = (FolderTableSource)tableView.DataSource;
                var folder = folderSource.getFolder (indexPath);
                owner.FolderSelected (folder);
            }
        }
    }
}
