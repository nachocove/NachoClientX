// This file has been autogenerated from a class added in the UI designer.

using System;
using Foundation;
using UIKit;
using NachoCore;
using NachoCore.Utils;

namespace NachoClient.iOS
{
    public partial class TaskListViewController : NcUITableViewController
    {
        public TaskListViewController (IntPtr handle) : base (handle)
        {
        }

        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();

            // Multiple buttons on the right side
            var addButton = new NcUIBarButtonItem (UIBarButtonSystemItem.Add);
            NavigationItem.RightBarButtonItems = new UIBarButtonItem[] { addButton };


            // Watch for changes from the back end
            NcApplication.Instance.StatusIndEvent += (object sender, EventArgs e) => {
                var s = (StatusIndEventArgs)e;
                if (NcResult.SubKindEnum.Info_TaskSetChanged == s.Status.SubKind) {
                    RefreshTaskList ();
                }
            };
        }

        public override void ViewWillAppear (bool animated)
        {
            base.ViewWillAppear (animated);
            if (null != this.NavigationController) {
                this.NavigationController.ToolbarHidden = true;
            }
            RefreshTaskList ();
        }

        protected void RefreshTaskList ()
        {
            this.TableView.DataSource = new TaskTableSource ();
            this.TableView.ReloadData ();
        }
    }
}
