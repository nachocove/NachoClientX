// This file has been autogenerated from a class added in the UI designer.

using System;

using MonoTouch.Foundation;
using MonoTouch.UIKit;

namespace NachoClient.iOS
{
    public partial class SettingsLegalViewController : NcUIViewController
    {
        protected string url;
        protected string title;
        protected bool isUrl;

        UIBarButtonItem backButton;

        public SettingsLegalViewController (IntPtr handle) : base (handle)
        {
            backButton = new UIBarButtonItem (UIBarButtonSystemItem.Done);
        }

        public void SetProperties (string aUrl, string aTitle, bool isUrl)
        {
            url = aUrl;
            title = aTitle;
            this.isUrl = isUrl;
        }

        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();

            if (isUrl) {
                CreateUrlView ();
            } else {
                CreateNonUrlView ();
            }

            backButton.Clicked += (object sender, EventArgs e) => {
                NavigationController.DismissViewController (true, new NSAction (delegate {
                    NavigationController.PopToRootViewController (false);
                }));
            };
        }

        public override void ViewDidAppear (bool animated)
        {
            base.ViewDidAppear (animated);
            NavigationItem.LeftBarButtonItem = backButton;
        }

        protected void CreateUrlView ()
        {
            UIWebView webView = new UIWebView (View.Frame);
            View.Add (webView);
            webView.LoadRequest (new NSUrlRequest (new NSUrl (url)));
            NavigationItem.Title = title;
        }

        protected void CreateNonUrlView ()
        {
            var textView = new UITextView (View.Frame);
            View.Add (textView);
            textView.Text =  System.IO.File.ReadAllText(url);
            NavigationItem.Title = title;
        }
    }
}
