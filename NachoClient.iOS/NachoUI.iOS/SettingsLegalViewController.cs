// This file has been autogenerated from a class added in the UI designer.

using System;

using Foundation;
using UIKit;
using CoreGraphics;
using System.Net;
using NachoCore.Model;
using NachoCore.Utils;
using NachoCore;
using NachoPlatform;


namespace NachoClient.iOS
{
    public partial class SettingsLegalViewController : UIViewController, IUIWebViewDelegate
    {

        public NSUrl DocumentLocation;

        UIWebView WebView;
        NcActivityIndicatorView ActivityIndicator;

        public SettingsLegalViewController () : base ()
        {
        }

        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();
            WebView = new UIWebView (View.Bounds);
            WebView.AutoresizingMask = UIViewAutoresizing.FlexibleWidth | UIViewAutoresizing.FlexibleHeight;
            WebView.Delegate = this;
            WebView.SuppressesIncrementalRendering = true;
            View.AddSubview (WebView);
            ActivityIndicator = new NcActivityIndicatorView (new CGRect (0, 0, 40, 40));
            ActivityIndicator.Center = new CGPoint (View.Bounds.Width / 2.0f, View.Bounds.Height / 2.0f);
            View.AddSubview (ActivityIndicator);
            ActivityIndicator.StartAnimating ();
            var request = new NSUrlRequest (DocumentLocation);
            WebView.LoadRequest (request);
        }

        public override void ViewWillDisappear (bool animated)
        {
            base.ViewWillDisappear (animated);
            if (IsMovingFromParentViewController) {
                WebView.Delegate = null;
                WebView.StopLoading ();
            }
        }

        [Export ("webViewDidFinishLoad:")]
        public virtual void LoadingFinished (UIWebView webView)
        {
            FinishLoad ();
        }

        [Export ("webView:didFailLoadWithError:")]
        public virtual void LoadFailed (UIWebView webView, NSError error)
        {
            FinishLoad ();
        }

        void FinishLoad ()
        {
            ActivityIndicator.StopAnimating ();
            ActivityIndicator.Hidden = true;
        }
    }
}
