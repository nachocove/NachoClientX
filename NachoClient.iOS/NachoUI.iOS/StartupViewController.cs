// This file has been autogenerated from a class added in the UI designer.

using System;
using MonoTouch.Foundation;
using MonoTouch.UIKit;
using SWRevealViewControllerBinding;
using NachoCore;
using NachoCore.Model;
using NachoCore.Utils;

namespace NachoClient.iOS
{
    public partial class StartupViewController : NcUIViewController
    {

        public StartupViewController (IntPtr handle) : base (handle)
        {
        }

        /// <summary>
        /// On first run, push the modal LaunchViewController to get credentials.
        /// </summary>
        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();

            PerformSegue (NextSegue (), this);
        }

        public static string NextSegue()
        {
            bool hasSynced;
            bool hasCreds;
            bool hasViewedTutorial;
            int accountId;

            if (LoginHelpers.IsCurrentAccountSet ()) {
                accountId = LoginHelpers.GetCurrentAccountId ();
                hasSynced = LoginHelpers.HasFirstSyncCompleted (accountId);
                hasCreds = LoginHelpers.HasProvidedCreds (accountId);
                hasViewedTutorial = LoginHelpers.HasViewedTutorial (accountId);
            } else {
                hasSynced = false;
                hasCreds = false;
                hasViewedTutorial = false;
            }

            if (!hasCreds) {
                return "SegueToLaunch";
            } else if (!hasViewedTutorial) {
                return "SegueToHome";
            } else if (!hasSynced) {
                return "SegueToAdvancedLogin";
            } else {
                return "SegueToNachoNow";
            }
        }



        public override void ViewWillAppear (bool animated)
        {
            base.ViewWillAppear (animated);
            if (null != this.NavigationController) {
                this.NavigationController.ToolbarHidden = true;
            }
        }

    }
}
    