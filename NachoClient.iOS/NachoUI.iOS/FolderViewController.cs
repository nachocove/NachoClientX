// This file has been autogenerated from a class added in the UI designer.

using System;
using MonoTouch.Foundation;
using NachoCore;
using NachoCore.Model;
using MonoTouch.UIKit;
using SWRevealViewControllerBinding;

namespace NachoClient.iOS
{
    public partial class FolderViewController : UITableViewController
    {
        /*
         *  FIXME - need to make sure that folder table and number of rows gets updated as new events from 
         *         - from BE come in. Right now fixed length array will cause fault if email comes in.
         *  FIXME - need to add logic for adding folder, 
         */
        McAccount currentAccount { get; set; }

        public void SetAccount (McAccount ncaccount)
        {
            currentAccount = ncaccount;
        }

        public override void ViewDidLoad ()
        {
            base.ViewDidLoad ();

            // Setup our list of folders
            TableView.Source = new FolderTableSource ();

            // Navigation
            revealButton.Action = new MonoTouch.ObjCRuntime.Selector ("revealToggle:");
            revealButton.Target = this.RevealViewController ();
            this.View.AddGestureRecognizer (this.RevealViewController ().PanGestureRecognizer);
        }

        public override void ViewWillAppear (bool animated)
        {
            base.ViewWillAppear (animated);
            this.TableView.ReloadData ();
        }

        public override void PrepareForSegue (UIStoryboardSegue segue, NSObject sender)
        {
            if (segue.Identifier == "mailview") {
                var msgview = (MessageViewController)segue.DestinationViewController; //our destination
                var source = TableView.Source as FolderTableSource;
                var rowPath = TableView.IndexPathForSelectedRow;
                var folder = source.getFolder (rowPath);
                msgview.SetFolder (folder);
            }
        }

        public FolderViewController (IntPtr handle) : base (handle)
        {
        }
    }
}
